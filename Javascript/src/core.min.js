!function(e){"use strict";var t=new function(){function e(){c.controlVars.update.finish=!0;var e=(new Date).getTime();c.time.miliseconds=e,c.time.interval=setInterval(function(){if(c.controlVars.update.finish){c.controlVars.update.finish=!1,c.controlVars.update.alerted=!1,c.controlVars.update.exceeded=0;var e=(new Date).getTime(),t=e-c.time.miliseconds;c.time.elapsedTime+=t,c.time.deltaTime=t/1e3*c.time.speed,c.time.miliseconds=e,c.time.FPS=1/c.time.deltaTime,c.time.FPSsum+=c.time.FPS,c.time.FPScount++,a()}else c.controlVars.update.exceeded++,c.time.lossedFrames++,c.controlVars.update.exceeded>=c.controlVars.update.alert&&($d.LogWarning("Loosing frames, consider using a lower maxFPS("+c.time.FPS+") value or reivew your code."),c.controlVars.update.alerted=!0)},1e3/c.time.maxFPS)}function a(){try{c.user.udpate()}catch(e){$d.LogError("Error in User Update function",e)}n(),s(),o(),c.controlVars.update.finish=!0}function o(){c.ctx.font="12px Arial",c.ctx.fillStyle="#000",c.ctx.fillText("FPS: "+Math.round(c.time.FPS),10,10)}function n(){for(var e,t=0;t<c.phycs.length;t++)e=c.phycs[t],e.kinematic||(r(e),e.collider.checked=c.time.elapsedTime,e.rotation+=e.angularVelocity*c.time.deltaTime,e.velocity.x+=e.force.x,e.velocity.y-=c.world.gravity,e.velocity.y+=e.force.y,e.pos.x+=e.velocity.x*c.time.deltaTime,e.pos.y+=e.velocity.y*c.time.deltaTime,e.pos.y<9&&(e.pos.y=5,e.velocity.y=-e.velocity.y*e.bounce))}function r(e){for(var a,o=new t.Vector2(0,0),n=0;n<c.phycs.length;n++)if(a=c.phycs[n],a.collider.checked!=c.time.elapsedTime&&a!=e){o.x=a.pos.x-e.pos.x,o.y=a.pos.y-e.pos.y;var r=o.magnitude();if(r=r-e.collider.maxRadius-a.collider.maxRadius,0>r){var i=l(e,a);e.collider.contactPoint=i.bestDistance<0?i.faceIndex:void 0}}}function i(e,a){for(var o=-1e6,n=new t.Vector2(0,0),r=0;r<e.collider.vertexs.length;r++){var i=new t.Vector2(e.collider.vertexs[r].x,e.collider.vertexs[r].y);i.rotate(e.rotation);var l=new t.Vector2(i.x+e.pos.x,i.y+e.pos.y),s=a.dot(l);s>o&&(n=l,o=s)}return n}function l(e,a){for(var o,n=-1e6,r=0;r<e.collider.vertexs.length;r++){var l=new t.Vector2(e.collider.normals[r].x,e.collider.normals[r].y);l.rotate(e.rotation);var s=i(a,new t.Vector2(-l.x,-l.y)),d=new t.Vector2(e.collider.vertexs[r].x,e.collider.vertexs[r].y);d.rotate(e.rotation);var c=new t.Vector2(d.x+e.pos.x,d.y+e.pos.y),u=new t.Vector2(s.x-c.x,s.y-c.y),m=l.dot(u);m>n&&(n=m,o=r)}return{bestDistance:n,faceIndex:o}}function s(){c.ctx.globalAlpha=c.globals.opacity,c.ctx.fillStyle=c.globals.background,c.ctx.fillRect(0,0,c.size.x,c.size.y),c.ctx.globalAlpha=1;for(var e=0;e<c.layers.length;e++)for(var t=0;t<c.layers[e].length;t++)d(c.layers[e][t])}function d(e){if(c.debug){if(c.ctx.fillStyle=e.color,c.ctx.translate(e.pos.x,c.size.y-e.pos.y),c.ctx.rotate(e.rotation*Math.PI/180),c.ctx.fillRect(-5,-5,10,10),c.debug&&void 0!=e.collider){if(c.ctx.beginPath(),1==e.collider.type)c.ctx.arc(0,0,e.collider.radius,0,2*Math.PI);else{c.ctx.moveTo(e.collider.vertexs[e.collider.vertexs.length-1].x,-e.collider.vertexs[e.collider.vertexs.length-1].y);for(var t=0;t<e.collider.vertexs.length;t++)c.ctx.lineTo(e.collider.vertexs[t].x,-e.collider.vertexs[t].y)}c.ctx.strokeStyle="#0F4",c.ctx.stroke(),c.ctx.fillStyle="#F77",void 0!=e.collider.contactPoint&&c.ctx.fillRect(e.collider.vertexs[e.collider.contactPoint].x-2,-e.collider.vertexs[e.collider.contactPoint].y-2,4,4)}c.ctx.rotate(-e.rotation*Math.PI/180),c.ctx.translate(-e.pos.x,-(c.size.y-e.pos.y))}}var c={debug:!0,started:!1,canvas:"",ctx:"",size:0,time:{FPS:1,FPScount:0,FPSsum:0,lossedFrames:0,maxFPS:60,deltaTime:1,startTime:0,elapsedTime:0,miliseconds:0,speed:1},controlVars:{update:{finish:!1,exceeded:0,alert:50,alerted:!1},start:!1},world:{gravity:10,drag:1},globals:{maxForce:150,opacity:.9,background:"#FFF"},layers:[],phycs:[],user:{}};this.init=function(t,a,o){if(c.started)$d.LogWarning("The engine is already running!");else if(void 0!=t&&"object"==typeof t)if("function"==typeof a&&"function"==typeof o)try{c.ctx=t.getContext("2d"),c.size=new this.Vector2(0,0),c.size.x=t.width,c.size.y=t.height,c.user.start=a,c.user.udpate=o,e(),c.started=!0}catch(n){$d.LogError("The element is not a canvas")}else $d.LogError("Missing Start/Update functions");else $d.LogError("Invalid element")},this.setMaxFPS=function(e){"number"==typeof e?c.time.maxFPS=e:$d.LogError("Invalid value, expected number")},this.setDebug=function(e){"boolean"==typeof e?c.debug=e:$d.LogError("Invalid value, expected boolean")},this.setSpeed=function(e){"number"==typeof e?c.time.speed=e:$d.LogError("Invalid value, expected number")},this.stats=function(){$d.Log("STATS"),$d.Log("FPS: "+c.time.FPS),$d.Log("Current state: "+(c.started?"Running":"Stopped")),$d.Log("Frame loss count: "+c.time.lossedFrames),$d.Log("Elapsed Time: "+$d.FormatMiliseconds(c.time.elapsedTime)),$d.Stats()},this.add2DObject=function(e,t){var a=c.phycs.push(e);void 0==c.layers[t+50]&&(c.layers[t+50]=[]),c.layers[t+50].push(c.phycs[a-1])},this.Vector2=function(e,t){this.x=e,this.y=t},this.Object2D=function(e,a,o,n,r,i){this.name=e,this.pos=new t.Vector2(a,o),this.scale=new t.Vector2(1,1),this.rotation=0,this.kinematic=0==n,this.mass=n,this.drag=r,this.bounce=i,this.angularVelocity=0,this.velocity=new t.Vector2(0,0),this.force=new t.Vector2(0,0),this.color="#000"},this.Object2D.prototype.addForce=function(e,t,a){void 0==a||0==a?(this.velocity.x+=e,this.velocity.y+=t):(this.force.x+=e,this.force.y+=t)},this.Object2D.prototype.setCollider=function(e){this.collider=e},this.BoxCollider=function(e,a){t.BaseCollider.call(this,0),this.vertexs=[new t.Vector2(-e/2,a/2),new t.Vector2(e/2,a/2),new t.Vector2(e/2,-a/2),new t.Vector2(-e/2,-a/2)],this.calculateNormals()},this.CircleCollider=function(e){t.BaseCollider.call(this,1),this.radius=e},this.PolygonCollider=function(e){"object"==typeof e?e.length>=3?(t.BaseCollider.call(this,2),this.vertexs=e,this.calculateNormals()):$d.LogError("The polygon collider needs at least 3 points"):$d.LogError("Invalid value, expected Array")},this.BaseCollider=function(e){this.type=e,this.contactPoint,this.vertexs=[],this.normals=[],this.maxRadius=-1e6,this.checked=0},this.PolygonCollider.prototype.calculateNormals=this.BoxCollider.prototype.calculateNormals=function(){for(var e=0;e<this.vertexs.length;e++){var t=e+1;t==this.vertexs.length&&(t=0),this.normals.push(this.vertexs[e].normal(this.vertexs[t]));var a=this.vertexs[e].magnitude();this.maxRadius<a&&(this.maxRadius=a)}},this.Vector2.prototype.multiply=function(e){this.x=this.x*e,this.y=this.y*e},this.Vector2.prototype.normalized=function(){var e=this.magnitude();return new t.Vector2(this.x/e,this.y/e)},this.Vector2.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.Vector2.prototype.dot=function(e){return this.x*e.x+this.y*e.y},this.Vector2.prototype.cross=function(e){return this.x*e.y-e.x*this.y},this.Vector2.prototype.angle=function(e){return void 0==e?Math.atan2(this.y,this.x):Math.atan2(e.y-this.y,e.x-this.x)},this.Vector2.prototype.normal=function(e){return new t.Vector2(-(e.y-this.y),e.x-this.x)},this.Vector2.prototype.rotate=function(e){e*=Math.PI/180;var t=Math.cos(e),a=Math.sin(e);this.x=this.x*t-this.y*a,this.y=this.x*a+this.y*t},this.Vector2.prototype.toString=function(){return"X: "+this.x+"	Y: "+this.y}};e.$e=t}(window);
//# sourceMappingURL=core.min.js.map