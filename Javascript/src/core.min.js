!function(t){"use strict";var e=new function(){function t(){w.controlVars.update.finish=!0;var t=(new Date).getTime();w.time.miliseconds=t,w.mouse=new e.Vector2(0,0),w.console.size=new e.Vector2(50,50),w.console.position=new e.Vector2(w.size.x-w.console.size.x,0),w.mouse=new e.Object2D("Mouse",new e.Vector2(0,0),1,1,1),w.mouse.setCollider(new e.BoxCollider(.1,.1)),w.canvas.addEventListener("mousemove",function(t){c(w.canvas,t)},!1),w.time.interval=i()}function i(){return setInterval(function(){if(w.controlVars.update.finish){w.controlVars.update.finish=!1,w.controlVars.update.alerted=!1,w.controlVars.update.exceeded=0;var t=(new Date).getTime(),e=t-w.time.miliseconds;w.time.elapsedTime+=e,w.time.elapsedLastClear+=e,w.time.deltaTime=e/1e3*w.time.speed,w.time.miliseconds=t,w.time.FPS=1/(w.time.deltaTime/w.time.speed),w.time.FPSsum+=w.time.FPS,w.time.FPScount++,w.time.FPS>0&&w.time.FPS<w.time.minFPS?(w.catchUp&&$d.LogWarning("Running behind the main timeline ("+(w.time.FPS+w.time.behindTime)+" seconds) trying to catch up at "+w.time.catchUpTime+" seconds per frame."),w.time.behindTime+=w.time.deltaTime,w.time.deltaTime=1/w.time.minFPS):w.time.behindTime>0&&w.catchUp&&(w.time.behindTime<w.time.catchUpTime?(w.time.deltaTime+=w.time.behindTime*w.time.speed,w.time.behindTime=0,$d.LogWarning("Main timeline reached.")):(w.time.deltaTime+=w.time.catchUpTime*w.time.speed,w.time.behindTime-=w.time.catchUpTime*w.time.speed)),w.time.elapsedLastClear>=w.time.intervalClear?(w.time.elapsedLastClear=0,clearInterval(w.time.interval),r()):o()}else w.controlVars.update.exceeded++,w.time.lossedFrames++,w.controlVars.update.exceeded>=w.controlVars.update.alert&&($d.LogWarning("Loosing frames, consider using a lower maxFPS("+w.time.FPS+") value or reivew your code."),w.controlVars.update.alerted=!0)},1e3/w.time.maxFPS)}function r(){setTimeout(function(){w.controlVars.update.finish=!0,w.time.interval=i()},w.time.intervalRestartDelay)}function o(){try{w.user.udpate()}catch(t){$d.LogError("Error in User Update function",t)}d(),g(),s(),a(),n(),l(),w.controlVars.update.finish=!0}function s(){w.ctx.font="12px Arial",w.ctx.fillStyle="#000",w.ctx.fillText("FPS: "+Math.round(w.time.FPS),10,10)}function a(){var t="Mouse position: "+w.mouse.pos.x+","+w.mouse.pos.y;w.ctx.font="8pt Calibri",w.ctx.fillStyle="black",w.ctx.fillText(t,10,25)}function l(){}function n(){for(var t=0,e=w.debugVars.length-1;e>=0;e--)if(void 0==w.debugVars[e].duration||w.debugVars[e].duration>0){for(var i=w.debugVars[e].obj,r=0;r<w.debugVars[e].vars.length;r++)i=i[w.debugVars[e].vars[r]];var o=w.debugVars[e].name+":	"+i.toString(2);w.ctx.font="7pt Calibri",w.ctx.fillStyle="black",w.ctx.fillText(o,10,w.size.y-10*(w.debugVars.length-e-t)),void 0!=w.debugVars[e].duration&&w.debugVars[e].duration--}else t++}function c(t,e){var i=t.getBoundingClientRect();w.mouse.pos.x=e.clientX-i.left,w.mouse.pos.y=w.size.y-e.clientY+i.top,w.mouseover=u(w.mouse,!0)}function d(){for(var t,e=0;e<w.phycs.length;e++)if(t=w.phycs[e],!t.kinematic&&(u(t,!1),t.collider.checked=w.time.elapsedTime,t.rotation+=t.angularVelocity*w.time.deltaTime,t.angularVelocity*=t.drag,t.velocity.x+=t.force.x/t.mass,t.velocity.y-=w.world.gravity,t.velocity.y+=t.force.y/t.mass,t.pos=t.pos.sum(t.velocity.multiply(w.time.deltaTime)),t.newtonian))for(var i=0;i<w.phycs.length;i++){var r=w.phycs[i];if(r!=t&&r.newtonian){var o=r.pos.substract(t.pos),s=o.normalized();o=o.magnitude();var a=V.g*(t.mass*r.mass/o);s.scale(a),t.addForce(s)}}}function u(t,i){for(var r,o=t,s=new e.Vector2(0,0),a=0;a<w.phycs.length;a++)if(r=w.phycs[a],(r.collider.checked!=w.time.elapsedTime||i)&&!(r==t||o.kinematic&&r.kinematic)){s.x=r.pos.x-o.pos.x,s.y=r.pos.y-o.pos.y;var l=s.magnitude();if(l=l-o.collider.maxRadius-r.collider.maxRadius,0>l){var n,c,d,u,h,y=!1;if(1==o.collider.type&&1==r.collider.type){if(i)return r;y=!0;var v=r.pos.substract(o.pos).normalized();d=v.multiply(o.pos.substract(r.pos).magnitude()-o.collider.maxRadius-r.collider.maxRadius),n=o.pos.substract(r.pos).normalized(),c=r.pos.substract(o.pos).normalized(),u=v.multiply(o.collider.radius),h=v.multiply(-r.collider.radius)}else if(1!=o.collider.type||0!=r.collider.type&&2!=r.collider.type)if(0!=o.collider.type&&2!=o.collider.type||1!=r.collider.type){var f=x(t,r);if(f.intersect){if(i)return r;y=!0;var g=p(r,t);k=new e.Vector2(0,0),n=r.collider.normals[g.vertexIndex].clone(),n.rotate(r.rotation),h=r.collider.vertexs[g.vertexIndex];var b=p(t,r);j=new e.Vector2(0,0),c=o.collider.normals[b.vertexIndex].clone(),c.rotate(o.rotation),u=o.collider.vertexs[b.vertexIndex],d=f.mtd}}else{var V={vertex:-1,distance:1e6};if(-1==V.vertex)for(var T=0;T<o.collider.vertexs.length;T++){var F,S=o.collider.vertexs[T].rrotate(o.rotation).sum(o.pos),P=r.pos;F=T==o.collider.vertexs.length-1?o.collider.vertexs[0].rrotate(o.rotation).sum(o.pos):o.collider.vertexs[T+1].rrotate(o.rotation).sum(o.pos);var C=m(P,S,F);C.dist<r.collider.radius&&V.distance>C.dist&&(V.distance=C.dist,V.vertex=T,V.dir=C.nearest.substract(P).normalized(),u=C.nearest.substract(o.pos),h=V.dir.multiply(r.collider.radius))}if(-1!=V.vertex){if(i)return r;y=!0,d=V.dir.multiply(o.pos.substract(r.pos).magnitude()-o.collider.maxRadius-r.collider.maxRadius),n=r.pos.substract(o.pos).normalized(),j=new e.Vector2(0,0),c=o.collider.normals[V.vertex].clone(),c.rotate(o.rotation)}}else{var V={vertex:-1,distance:1e6};if(-1==V.vertex)for(var T=0;T<r.collider.vertexs.length;T++){var F,S=r.collider.vertexs[T].rrotate(r.rotation).sum(r.pos),P=o.pos;F=T==r.collider.vertexs.length-1?r.collider.vertexs[0].rrotate(r.rotation).sum(r.pos):r.collider.vertexs[T+1].rrotate(r.rotation).sum(r.pos);var C=m(P,S,F);C.dist<o.collider.radius&&V.distance>C.dist&&(V.distance=C.dist,V.vertex=T,V.dir=C.nearest.substract(P).normalized(),h=C.nearest.substract(r.pos),u=V.dir.multiply(o.collider.radius))}if(-1!=V.vertex){if(i)return r;y=!0,d=V.dir.multiply(r.pos.substract(o.pos).magnitude()-r.collider.maxRadius-o.collider.maxRadius),n=o.pos.substract(r.pos).normalized(),j=new e.Vector2(0,0),c=r.collider.normals[V.vertex].clone(),c.rotate(r.rotation)}}if(y){var z=(o.bounce+r.bounce)/2,$=z*(o.velocity.multiply(o.mass-r.mass).sum(r.velocity.multiply(2*r.mass)).magnitude()/(o.mass+r.mass)),I=z*(r.velocity.multiply(r.mass-o.mass).sum(o.velocity.multiply(2*o.mass)).magnitude()/(r.mass+o.mass)),R=o.velocity.clone(),L=R.dot(n);L=-2*L,n.scale(L);var k=R.sum(n);o.applyImpulse(k.normalized().multiply(I),u);var D=r.velocity.clone(),M=D.dot(c);M=-2*M,c.scale(M);var j=D.sum(c);r.applyImpulse(j.normalized().multiply($),h),o.kinematic?r.pos=r.pos.substract(d):r.kinematic?o.pos=o.pos.sum(d):(o.pos=o.pos.sum(d.multiply(r.mass/(r.mass+o.mass))),r.pos=r.pos.substract(d.multiply(o.mass/(r.mass+o.mass))))}}}}function m(t,e,i){var r=i.substract(e),o=t.substract(e),s=r.magnitude(),a=r.normalized(),l=o.multiply(1/s),n=a.dot(l);0>n?n=0:n>1&&(n=1);var c=r.multiply(n),d=c.substract(o).magnitude();return c=c.sum(e),{dist:d,nearest:c}}function h(t,i){for(var r=-1e6,o=new e.Vector2(0,0),s=0;s<t.collider.vertexs.length;s++){var a=t.collider.vertexs[s].clone();a.rotate(t.rotation);var l=t.pos.sum(a),n=i.dot(l);n>r&&(o=l,r=n)}return o}function p(t,i){for(var r,o=-1e6,s=0;s<t.collider.vertexs.length;s++){var a=t.collider.normals[s].clone();a.rotate(t.rotation);var l=h(i,a.multiply(-1)),n=new e.Vector2(t.collider.vertexs[s].x,t.collider.vertexs[s].y);n.rotate(t.rotation);var c=new e.Vector2(n.x+t.pos.x,n.y+t.pos.y),d=new e.Vector2(l.x-c.x,l.y-c.y),u=a.dot(d);u>o&&(o=u,r=s)}return{bestDistance:o,vertexIndex:r}}function x(t,i){for(var r=[],o=0,s=t.collider.vertexs.length-1,a=0;a<t.collider.vertexs.length;a++){var l=t.collider.vertexs[a].rrotate(t.rotation).sum(t.pos).substract(t.collider.vertexs[s].rrotate(t.rotation).sum(t.pos)),n=r[o++]=new e.Vector2(-l.y,l.x);if(v(n,t,i))return!1;s=a}s=i.collider.vertexs.length-1;for(var a=0;a<i.collider.vertexs.length;a++){var l=i.collider.vertexs[a].sum(i.pos).rrotate(i.rotation).substract(i.collider.vertexs[s].rrotate(i.rotation).sum(i.pos)),n=r[o++]=new e.Vector2(-l.y,l.x);if(v(n,t,i))return!1;s=a}var c=f(r,o),d=t.pos.substract(i.pos);return d.dot(c)<0&&c.scale(-1),{intersect:!0,mtd:c}}function y(t,e){var i,r,o=t.dot(e.collider.vertexs[0].rrotate(e.rotation).sum(e.pos));i=r=o;for(var s=0;s<e.collider.vertexs.length;s++){var o=e.collider.vertexs[s].rrotate(e.rotation).sum(e.pos).dot(t);i>o?i=o:o>r&&(r=o)}return{min:i,max:r}}function v(t,e,i){var r=y(t,e),o=y(t,i);if(r.min>o.max||o.min>r.max)return!0;var s=r.max-o.min,a=o.max-r.min,l=a>s?s:a,n=t.dot(t);return t.scale(l/n),!1}function f(t,e){for(var i=t[0].clone(),r=i.dot(i),o=1;e>o;o++){var s=t[o].dot(t[o]);r>s&&(r=s,i=t[o].clone())}return i}function g(){w.ctx.globalAlpha=w.globals.opacity,w.ctx.fillStyle=w.globals.background,w.ctx.fillRect(0,0,w.size.x,w.size.y),w.ctx.globalAlpha=1;for(var t=0;t<w.layers.length;t++)for(var e=0;e<w.layers[t].length;e++)b(w.layers[t][e])}function b(t){if(w.debug){w.ctx.fillStyle=t.color;var i=new e.Vector2(t.pos.x,w.size.y-t.pos.y);w.ctx.translate(i.x,i.y);var r=t.rotation*Math.PI/180;if(w.ctx.rotate(-r),w.mouseover==t&&(w.ctx.shadowBlur=2,w.ctx.shadowColor="#3c84c1"),1==t.collider.type?w.ctx.fillRect(-5,-5,10,10):w.ctx.fillRect(-5,-5,10,10),w.debug&&void 0!=t.collider){if(w.ctx.beginPath(),1==t.collider.type)w.ctx.arc(0,0,t.collider.radius,0,2*Math.PI);else{w.ctx.moveTo(t.collider.vertexs[t.collider.vertexs.length-1].x,t.collider.vertexs[t.collider.vertexs.length-1].y);for(var o=0;o<t.collider.vertexs.length;o++)w.ctx.lineTo(t.collider.vertexs[o].x,t.collider.vertexs[o].y)}w.ctx.strokeStyle="#AFA",w.ctx.stroke(),w.ctx.fillStyle="#F77",void 0!=t.collider.contactPoint&&w.ctx.fillRect(t.collider.vertexs[t.collider.contactPoint].x-2,t.collider.vertexs[t.collider.contactPoint].y-2,4,4)}w.ctx.rotate(r),w.ctx.font="6pt Calibri",w.ctx.fillStyle="black",w.ctx.fillText(t.name,0,0),w.ctx.translate(-i.x,-i.y),w.ctx.shadowBlur=0}}var V={g:.01},w={debug:!0,catchup:!1,started:!1,canvas:"",ctx:"",size:0,time:{FPS:1,FPScount:0,FPSsum:0,lossedFrames:0,maxFPS:60,minFPS:20,deltaTime:1,startTime:0,behindTime:0,elapsedTime:0,miliseconds:0,speed:1,catchUpTime:1/8,intervalClear:1e4,elapsedLastClear:0,intervalRestartDelay:40},controlVars:{update:{finish:!1,exceeded:0,alert:50,alerted:!1},start:!1},debugVars:[],console:{history:[],border:!1,font:"7pt Calibri",color:"black"},world:{gravity:10,drag:1},globals:{maxForce:150,opacity:.9,background:"#FFF"},mouse:0,mouseover:void 0,layers:[],phycs:[],user:{}};this.init=function(e,i,r){if(w.started)$d.LogWarning("The engine is already running!");else if(void 0!=e&&"object"==typeof e)if("function"==typeof i&&"function"==typeof r)try{w.canvas=e,w.ctx=e.getContext("2d"),w.size=new this.Vector2(0,0),w.size.x=e.width,w.size.y=e.height,w.user.start=i,w.user.udpate=r,t(),w.started=!0}catch(o){$d.LogError("The element is not a canvas")}else $d.LogError("Missing Start/Update functions");else $d.LogError("Invalid element")},this.setMaxFPS=function(t){$d.ValidateInput(arguments,["number"])&&(w.time.maxFPS=t)},this.setDebug=function(t){$d.ValidateInput(arguments,["boolean"])&&(w.debug=t)},this.setSpeed=function(t){$d.ValidateInput(arguments,["number"])&&(w.time.speed=t)},this.setGravity=function(t){$d.ValidateInput(arguments,["number"])&&(w.world.gravity=t)},this.setCatchUp=function(t){$d.ValidateInput(arguments,["boolean"])&&(w.catchUp=t)},this.stats=function(){$d.Log("STATS"),$d.Log("FPS: "+w.time.FPS),$d.Log("Current state: "+(w.started?"Running":"Stopped")),$d.Log("Frame loss count: "+w.time.lossedFrames),$d.Log("Elapsed Time: "+$d.FormatMiliseconds(w.time.elapsedTime)),$d.Stats()},this.add2DObject=function(t,e){if($d.ValidateInput(arguments,["object","number"])){var i=w.phycs.push(t);void 0==w.layers[e+50]&&(w.layers[e+50]=[]),w.layers[e+50].push(w.phycs[i-1])}},this.addDebugObject=function(t,e,i,r){$d.ValidateInput(arguments,["string","object","array[string]"],["number"])&&w.debugVars.push({name:t,obj:e,vars:i,duration:r})},this.writeDebugConsole=function(t,e){w.console.history.push({name:t,type:e})},this.Vector2=function(t,e){this.x=t,this.y=e},this.Object2D=function(t,i,r,o,s){this.name=t,this.pos=i.clone(),this.scale=new e.Vector2(1,1),this.rotation=0,this.kinematic=0==r,this.mass=0==r?1:r,this.newtonian=!1,this.drag=o,this.bounce=s,this.angularVelocity=0,this.velocity=new e.Vector2(0,0),this.force=new e.Vector2(0,0),this.color="#DDD"},this.Object2D.prototype.addForce=function(t,e){this.kinematic||(void 0==e||0==e?(this.velocity.x+=t.x/this.mass,this.velocity.y+=t.y/this.mass):(this.force.x+=t.x,this.force.y+=t.y))},this.Object2D.prototype.applyImpulse=function(t,e){if(!this.kinematic){this.velocity=t.clone();var i=e.rrotate(this.rotation).normalized(),r=t.dot(i),o=t.normalized().cross(i),s=-(r*o)/this.mass;$d.Log("DOT: "+r.toFixed(2)+"	CROSS: "+o.toFixed(2)+"	ROT: "+s.toFixed(2)),this.angularVelocity+=s}},this.Object2D.prototype.setCollider=function(t){this.collider=t},this.BoxCollider=function(t,i){e.BaseCollider.call(this,0),this.vertexs=[new e.Vector2(-t/2,i/2),new e.Vector2(t/2,i/2),new e.Vector2(t/2,-i/2),new e.Vector2(-t/2,-i/2)],this.calculateNormals()},this.CircleCollider=function(t){e.BaseCollider.call(this,1),this.radius=t,this.maxRadius=t},this.PolygonCollider=function(t){"object"==typeof t?t.length>=3?(e.BaseCollider.call(this,2),this.vertexs=t,this.calculateNormals()):$d.LogError("The polygon collider needs at least 3 points"):$d.LogError("Invalid value, expected Array")},this.BaseCollider=function(t){this.type=t,this.contactPoint,this.vertexs=[],this.normals=[],this.checked=!1,this.maxRadius=-1e6,this.checked=0},this.PolygonCollider.prototype.calculateNormals=this.BoxCollider.prototype.calculateNormals=function(){for(var t=0;t<this.vertexs.length;t++){var e=t+1;e==this.vertexs.length&&(e=0),this.normals.push(this.vertexs[t].normal(this.vertexs[e]).normalized());var i=this.vertexs[t].magnitude();this.maxRadius<i&&(this.maxRadius=i)}},this.Vector2.prototype.sum=function(t){return new e.Vector2(this.x+t.x,this.y+t.y)},this.Vector2.prototype.substract=function(t){return new e.Vector2(this.x-t.x,this.y-t.y)},this.Vector2.prototype.multiply=function(t){return new e.Vector2(this.x*t,this.y*t)},this.Vector2.prototype.scale=function(t){this.x=this.x*t,this.y=this.y*t},this.Vector2.prototype.normalize=function(){if(0!=this.x&&0!=this.y){var t=this.magnitude();this.x=this.x/t,this.y=this.y/t}},this.Vector2.prototype.normalized=function(){if(0==this.x&&0==this.y)return this;var t=this.magnitude();return new e.Vector2(this.x/t,this.y/t)},this.Vector2.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.Vector2.prototype.dot=function(t){return this.x*t.x+this.y*t.y},this.Vector2.prototype.cross=function(t){return this.x*t.y-t.x*this.y},this.Vector2.prototype.angle=function(t){return void 0==t?Math.atan2(this.y,this.x):Math.atan2(t.y-this.y,t.x-this.x)},this.Vector2.prototype.normal=function(t){return new e.Vector2(-(t.y-this.y),t.x-this.x)},this.Vector2.prototype.rotate=function(t){t*=Math.PI/180;var e=Math.cos(t),i=Math.sin(t);this.x=this.x*e-this.y*i,this.y=this.x*i+this.y*e},this.Vector2.prototype.rrotate=function(t){t*=Math.PI/180;var i=Math.cos(t),r=Math.sin(t);return new e.Vector2(this.x*i-this.y*r,this.x*r+this.y*i)},this.Vector2.prototype.swap=function(){var t=this.x;this.x=this.y,this.y=t},this.Vector2.prototype.clone=function(){return new e.Vector2(this.x,this.y)},this.Vector2.prototype.copy=function(t){this.x=t.x,this.y=t.y},this.Vector2.prototype.toString=function(t){return void 0!=t?"("+this.x.toFixed(t)+","+this.y.toFixed(t)+")":"("+this.x+","+this.y+")"}};t.$e=e}(window);
//# sourceMappingURL=core.min.js.map